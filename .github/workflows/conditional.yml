name: conditional

on:
    workflow_dispatch:

jobs:
    job_a:
        name: a1
        runs-on: ubuntu-latest
        steps:
            - run: echo "A"
            - id: set
              run: |
                echo "{run_job_b}={no}" >> $GITHUB_OUTPUT
        outputs:
            run_job_b: ${{steps.set.outputs.run_job_b}}
    
    job_b:
        name: b1
        runs-on: ubuntu-latest
        needs:
            - job_a
        if: needs.job_a.outputs.run_job_b == 'yes'
        steps:
            - run: echo "B"
    
    job_c:
        name: c1
        runs-on: ubuntu-latest
        needs:
            - job_a
            - job_b
        if: |
            always() &&
            (needs.job_a.result == 'success' &&
            (needs.job_b.result == 'success' || needs.job_b.result == 'skipped')
            )
        steps:
            - run: echo "C"
    
    slack_job:
        name: Post to a Slack channel
        runs-on: ubuntu-latest
        steps:
            name: Send Slack notification
            id: slack
            uses: slackapi/slack-github-action@v1.27.0
            with:
                # Slack channel id, channel name, or user id to post message.
                # See also: https://api.slack.com/methods/chat.postMessage#channels
                # You can pass in multiple channels to post to by providing a comma-delimited list of channel IDs.
                channel-id: 'C07MREJ4X4L'
                # try sending to channels outside of the current workspace.
                # For posting a simple plain text message
                slack-message: ":rocket: Action result: ${{ job.status }}"
              env:
                SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
                SLACK_TOKEN: ${{ secrets.MY_SLACK_TOKEN }}